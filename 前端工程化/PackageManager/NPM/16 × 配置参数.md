
npm 从以下来源获取其配置。按优先级排序分别为：命令行参数 → 环境变量 → 项目配置文件 → 用户配置文件 → 全局配置文件。

[[前端工程化/PackageManager/NPM/assets/b4ef5b646c28459879ad3a7cdba46f39_MD5.svg|Open: npm-config-steps.svg]]
![[前端工程化/PackageManager/NPM/assets/b4ef5b646c28459879ad3a7cdba46f39_MD5.svg]]

## Global Config

全局配置。

配置文件位于 `${PREFIX}/etc/npmrc` 。

使用 `npm config` 命令可以获取或设置全局配置文件的位置。
```shell
npm config get globalconfig
npm config set globalconfig xxxx
```

也可以在命令行中通过 `--globalconfig` 选项自定义。
```shell
npm run build --globalconfig xxxx
```

或 `npm_config_globalconfig` 环境变量进行自定义。
```shell
export npm_config_globalconfig xxxx
```

## User Config

用户配置。

配置文件位于 `~/.npmrc`

使用 `npm config` 命令可以获取或设置用户配置文件的位置：
```shell
npm config get userconfig
npm config set userconfig xxx
```

在命令行中也可以通过 `--userconfig` 参数或 `npm_config_userconfig` 环境变量进行自定义。
```shell
npm run build --userconfig xxxx
export npm_config_userconfig xxxx
```

## Project Config

项目配置。
配置文件位于项目根目录，文件名称为： `.npmrc` 

## Enviroment Variables

NPM 命令执行时也会从环境变量中获取配置参数。
NPM 的环境变量固定以 `npm_config_*` 的格式，请使用小写。

> 注意，您需要使用下划线而不是破折号，因此 `--allow-same-version` 将变为 `npm_config_allow_same_version=true`。

```shell
export npm_config_timing=true
```

## Command Line Flags

命令行选项。

使用双连字符时，参数名必须全写 `--bar value` 。
使用单连字符是，参数名可以简写 `-b value` 。

```shell
npm run build --ignore-scripts false
npm i chalk -g
```

## 配置方式的优先级

在命令行执行以下操作，并使用 `npm config ls` 查看最终的结果配置。

```shell
npm config set auth-type web -g
npm config set auth-type legacy
```

```shell
➜  app-mono npm config ls
; "global" config from /Users/xxx/.nvm/versions/node/v16.18.1/etc/npmrc

; auth-type = "web" ; overridden by user

; "user" config from /Users/xxx/.npmrc

auth-type = "legacy" 

; node bin location = /Users/xxx/.nvm/versions/node/v16.18.1/bin/node
; node version = v16.18.1
; npm local prefix = /Users/xxx/Desktop/Study/app-mono
; npm version = 8.19.2
; cwd = /Users/xxx/Desktop/Study/app-mono
; HOME = /Users/xxx
; Run `npm config ls -l` to show all defaults.
```

从上我们可以看出用户配置覆盖了全局配置。

现在进入到项目根目录执行如下操作：
```shell
echo "auth-type = web" > .npmrc
export npm_config_auth_type=legacy
```

最后使用 `npm config ls` 命令查看最终的结果配置：
```shell
; "global" config from /Users/xxx/.nvm/versions/node/v16.18.1/etc/npmrc

; auth-type = "web" ; overridden by env

; "user" config from /Users/xxx/.npmrc

; auth-type = "legacy" ; overridden by env

; "project" config from /Users/xxx/Desktop/Study/app-mono/.npmrc

; auth-type = "web" ; overridden by env

; "env" config from environment

auth-type = "legacy" 

; node bin location = /Users/xxx/.nvm/versions/node/v16.18.1/bin/node
; node version = v16.18.1
; npm local prefix = /Users/xxx/Desktop/Study/app-mono
; npm version = 8.19.2
; cwd = /Users/taptap/xxx/Study/app-mono
; HOME = /Users/taptap
; Run `npm config ls -l` to show all defaults.
```

可以发现环境变量将全局配置、用户配置以及项目配置都覆盖了。若需要覆盖环境变量，则可以使用命令行参数进行配置：
```shell
npm login --auth-type web
```

## 查看全部配置

在查看配置时，附加 `-l` 参数可以查看 npm 的全部配置以及配置的初始值。
```shell
npm config ls -l
```

## 常用配置

>[!Note]
>不同的配置参数适合不同的命令，相同的配置参数在不同命令下功能也不尽相同。

### registry

注册表 URL。默认值：https://npmjs.registry.org

### replace-registry-host

替换注册表主机地址，默认值 npmjs。

### save-prefix

配置包安装到 `pacakge.json` 后其语义化版本的前缀（semver range prefix），默认值： `^` 。

### all

设置 `--all` 参数的值。受影响命令如 `outdated` 以及 `ls` 等。

### \_auth

对 npm 注册表进行身份验证时使用的基本身份验证字符串（访问令牌）。

> 通常你不应该在命令行中设置该配置，而是配置在 `.npmrc` 配置文件中。

### audit-level

设置漏洞的检查等级。

取值：info 、moderate、high、critical 。默认值 `info`

### auth-type

身份验证的交互方式。

取值：legacy、web。默认值 `web` 。

### access

发布包时设置发布到公共还是私有。

取值：`public` | `restricted` 。默认值 `public`

### cidr

这是使用 `npm token create` 命令配置受限访问令牌时要使用的 CIDR 地址列表。

### commit-hooks

使用 `npm version` 命令时运行 git commit hooks。

### depth

设置 `npm ls` 递归包时的深度。

取值数值、null。默认值为 `1` 只查看项目的直接依赖。

如果命令行参数指定了 `--all` 时，则取值为 `Infinity`

### diff-unified

设置 diff 内容的上下文行数，默认值 3

### fetch-timeout

npm 获取包的超时时间。默认值 5 分钟。

### git-tag-version

控制 `npm version` 命令是否可以创建 commit 与 tag。

### https-proxy

设置 npm 的 HTTPS 代理服务器。

### if-present

如果为 true，当要执行的脚本命令没有在 package.json 的 scripts 字段中定义，并不会报错并退出。这对于在 CI 环境以及多工作区的场景下非常有用。

### ignore-scripts

如果为 ture，只会运行确定的脚本命令，而不会运行脚本命令的任何前置或后置以及生命周期脚本。

### include-workspace-root

如果为 true，则在工作区中执行命令时也包含根工作区（根包）。

### install-strategy

设置 npm 安装依赖的策略。

取值：枚举值。`hoisted`：提升；`nested`：嵌套；`linked`：使用符号链接（类似于 pnpm）。 默认值： `hoisted`。

注意，因为`package-lock.json` 会记录依赖树的结构，所以当更改安装策略后，要记得删除 `lock` 文件，然后重新安装依赖。

> `npm 9.4` 以上版本支持

### foreground-scripts

npm 7.x 之后的版本会将一些生命周期脚本放置在后台中运行，例如 `prepare` 、`dependencies` ，使用该参数可以将它们重新放在前台进程中运行。

### loglevel

日志等级，默认 `notice` 。

### message

`npm version` 触发 git commit 时指定的 message 消息，可以用宏变量 `%s` 代替具体的版本号。

### offline

强制离线模式，npm 命令执行期间不会请求任何网络请求。

### prefer-offline

执行 npm 命令时尽可能的使用本地缓存，但如果本地缓存中没有找到所需的包，npm 仍然会从远程仓库下载它。

要强制完全离线请使用 `--offline` 。

### prefix

npm 与 node 的安装前缀路径。

### preid

先行版本号的 ID

### timing

是否输出计时信息，并以 `*-timing.json` 的文件存储在 `_logs` 目录中。

### strict-peer-deps

是否开启严格对等依赖策略。如果要安装的包有声明 `peer` 依赖，npm 便会验证已安装依赖的版本是否符合声明的 `peer` 版本要求？如果不符合便会报错并组织安装。

默认值 `false` 。

### legacy-peer-deps

如果为 `true` 则完全忽略 `peer` 依赖冲突的情况。如果一个包由于过于严格的 `peerDependencies` 冲突而无法安装，它提供了一种解决问题的方法。

### 更多配置

https://docs.npmjs.com/cli/v9/using-npm/config