## Changesets æ˜¯ä»€ä¹ˆï¼Ÿ

å®˜æ–¹è¯´æ˜ï¼š

	A tool to manage versioning and changelogs with a focus on multi-
	package repositoriesã€‚
	......
	publishing new versions of packages based on the provided information.

å½’çº³æ€»ç»“ï¼š

**ä¸€æ¬¾ä¸“æ³¨äº `Monorepo` ä»“åº“çš„â€œç‰ˆæœ¬æå‡â€ä¸â€œæ—¥å¿—å˜æ›´â€çš„å·¥å…·ã€‚ä¹Ÿæ˜¯ Monorepo åœºæ™¯ä¸‹å¸¸ç”¨çš„å‘åŒ…å·¥å…·ã€‚**

æ ¸å¿ƒåŠŸèƒ½ï¼š

- [*] ç‰ˆæœ¬æå‡ï¼šä¼šä¿®æ”¹ `package.json`æ–‡ä»¶çš„ `version` å­—æ®µã€‚
- [*] æ—¥å¿—å˜æ›´ï¼šâ€œåŒ…â€æ ¹ç›®å½•åˆ›å»º `CHANGELOG.md` æ–‡ä»¶å¹¶è¿½åŠ æ—¥å¿—è¯¦æƒ…ã€‚
- [*] å‘å¸ƒå˜æ›´ï¼šè‡ªåŠ¨è¯†åˆ«â€œåŒ…â€æ˜¯å¦å­˜åœ¨æ–°çš„ç‰ˆæœ¬éœ€è¦å‘å¸ƒã€‚

>[!question]
>**â€œå˜æ›´æ—¥å¿—â€**ï¼šåœ¨åˆ†æ”¯æˆ–æäº¤ä¸­æ‰€åšå‡ºæ›´æ”¹çš„ä¿¡æ¯è¯´æ˜ã€‚
>**â€œMulti-Package Repositoriesâ€**: å¤šåŒ…å­˜å‚¨åº“ï¼ŒMonorepo çš„ç§°å‘¼æ–¹å¼ä¹‹ä¸€ã€‚
>

è€Œèƒ½è®© `Changesets` åšå‡ºä»¥ä¸Šä¸¤ä¸ªè¡Œä¸ºçš„å‰æå°±æ˜¯åˆ›å»ºâ€œå˜æ›´é›†æ–‡ä»¶ï¼ˆchangesetï¼‰â€ã€‚

## Changeset æ˜¯ä»€ä¹ˆï¼Ÿ

â€œå˜æ›´é›†â€æ–‡ä»¶ã€‚ä¸€ä¸ªå¸¦æœ‰ YAML å‰è¨€çš„ Markdown æ–‡ä»¶ï¼Œå®ƒä¸»è¦åŒ…å«ä¸¤éƒ¨åˆ†å†…å®¹ï¼š
* **å‰è¨€æ•°æ®**ï¼šå˜æ›´é›†æ–‡ä»¶çš„å…ƒä¿¡æ¯ã€‚åŒ…å«äº†å—å½±å“çš„åŒ…ä»¥åŠæ„å›¾æå‡çš„ç‰ˆæœ¬ç±»å‹ã€‚
* **å†…å®¹æ‘˜è¦**ï¼šå…·ä½“çš„â€œå˜æ›´æ—¥å¿—â€ã€‚
```markdown
---
"@myproject/cli": major 
"@myproject/core": minor
"@myproject/main": patch
---
Change all the things
```
^e097f9

â€œå˜æ›´é›†æ–‡ä»¶â€å­˜æ”¾åœ¨é¡¹ç›®æ ¹ç›®å½• `.changeset` çš„éšè—ä»¶å¤¹ä¸­ï¼š
```
.changeset
â”œâ”€â”€ UNIQUE_ID.md
â””â”€â”€ config.json
```

## å¿«é€ŸæŒ‡å—

### å®‰è£… changesets/cli

```bash
npm i @changesets/cli --save-dev
```

### åˆå§‹åŒ–é¡¹ç›®

åœ¨ `package.json` æ–‡ä»¶çš„ `scripts` å­—æ®µï¼Œæ·»åŠ ä»¥ä¸‹å‘½ä»¤ï¼š
```json
"scripts":{
	"changeset":"changeset"
}
```

æ‰§è¡Œå‘½ä»¤åˆå§‹åŒ–é¡¹ç›®ï¼š
```shell
npm run changeset init
```

`init` å‘½ä»¤æ‰§è¡Œå®Œæˆåï¼Œä¼šåœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª`.changeset` ç›®å½•ï¼Œå¹¶è‡ªåŠ¨åˆ›å»ºä¸€ä¸ª `config.json` æ–‡ä»¶ã€‚å‘½ä»¤çš„æ‰§è¡ŒåŸç†éå¸¸ç®€å•ï¼Œå°±æ˜¯ç”¨ `fs` åº“å°†é…ç½®æ–‡ä»¶ä»¥åŠç›®å½•ç»“æ„å†™å…¥åˆ°é¡¹ç›®æ ¹ç›®å½•ä¸‹ã€‚

### åˆ›å»ºå˜æ›´é›†æ–‡ä»¶

æ‰§è¡Œ `npm run changeset` æˆ– `npm run changeset add` å‘½ä»¤å¯ä»¥æ‰“å¼€äº¤äº’å¼å‘½ä»¤è¡Œæ¥åˆ›å»ºå˜æ›´é›†æ–‡ä»¶ã€‚ä¸»è¦ç»è¿‡ä¸‹é¢ä¸‰ä¸ªå­æ­¥éª¤ï¼š

**1. Which Packages**
	é¦–å…ˆï¼Œé€‰æ‹©è¦æ›´å˜æ›´çš„åŒ…ï¼ŒChangesets åº•å±‚é€šè¿‡ `@manpkg/get-packages` åŒ…æ¥æ„å»ºå‡º Monorepo ä¸­æ‰€æœ‰å­åŒ…çš„ä¾èµ–å›¾ï¼Œå¹¶ä½¿ç”¨ `git diff` å‘½ä»¤è·å–è·å–æœ¬æ¬¡æ‰€æœ‰ commit æ¶‰åŠåˆ°çš„å­˜åœ¨å˜æ›´çš„åŒ…ï¼Œä¸è¿‡å³ä½¿æ²¡æœ‰ä¿®æ”¹çš„åŒ…ï¼Œç”¨æˆ·ä¹Ÿèƒ½é€‰æ‹©ã€‚

**2. Bump Version**
	ç´§æ¥ç€å¼€å§‹é€‰æ‹©è¦å˜æ›´çš„ç‰ˆæœ¬ç±»å‹ï¼ŒChangesets åº•å±‚é€šè¿‡ `semver` åŒ…æ¥å®ç°è¯­ä¹‰åŒ–ç‰ˆæœ¬æ§åˆ¶ã€‚ä¸»ç‰ˆæœ¬(major)ã€æ¬¡ç‰ˆæœ¬(minor)ã€è¡¥ä¸ç‰ˆæœ¬(patch)ã€‚

**3. Enter Summary**
	æœ€åï¼Œå¡«å…¥ `Summary` ä¹Ÿå°±æ˜¯æˆ‘ä»¬å˜æ›´çš„æ‘˜è¦å†…å®¹ï¼Œæœ€ç»ˆå°±ä¼šç”Ÿæˆä¸€ä¸ªåç§°éšæœºä½†äººç±»å¯è¯»çš„ changeset æ–‡ä»¶äº†ã€‚æ–‡ä»¶æ ¼å¼å¦‚ï¼š[[#^e097f9]] æ‰€ç¤ºã€‚
	â€œå˜æ›´é›†â€æ–‡ä»¶åæ˜¯ç”±åº•å±‚çš„ `human-id` åŒ…ç”Ÿæˆçš„å…·æœ‰éšæœºï¼Œäººç±»å¯è¯»çš„åç§°ï¼Œä»¥é¿å…åœ¨ç”Ÿæˆå®ƒä»¬æ—¶å‘ç”Ÿå†²çªã€‚

ä¸‹é¢æ˜¯å‘½ä»¤å®Œæ•´çš„äº¤äº’è¿‡ç¨‹ï¼š
``` shell
âœ  changesets-test git:(master) âœ— npm run changeset
> changesets-test@1.0.0 changeset

ğŸ¦‹  Which packages would you like to include? Â· plugin, core, pkg
ğŸ¦‹  Which packages should have a major bump? Â· No items were selected
ğŸ¦‹  Which packages should have a minor bump? Â· plugin, core, pkg
ğŸ¦‹  Please enter a summary for this change (this will be in the changelogs).
ğŸ¦‹    (submit empty line to open external editor)
ğŸ¦‹  Summary Â· write change summary
ğŸ¦‹  
ğŸ¦‹  === Summary of changesets ===
ğŸ¦‹  minor:  plugin, core, pkg
ğŸ¦‹  
ğŸ¦‹  Note: All dependents of these packages that will be incompatible with
ğŸ¦‹  the new version will be patch bumped when this changeset is applied.
ğŸ¦‹  
ğŸ¦‹  Is this your desired changeset? (Y/n) â€º true
```

>[!tip]
>ä¹Ÿå¯ä»¥å®Œå…¨æ‰‹åŠ¨åˆ›å»º changeset æ–‡ä»¶ï¼Œè¿™æ˜¯è¢«å…è®¸çš„ã€‚

### æ¶ˆè€—å˜æ›´é›†æ–‡ä»¶

åˆ›å»ºå˜æ›´é›†æ–‡ä»¶ä¸ä¼šæ‰§è¡Œç‰ˆæœ¬å˜æ›´ä¸æ—¥å¿—è®°å½•çš„è¡Œä¸ºï¼Œåªæœ‰åœ¨æ¶ˆè€—å˜æ›´é›†æ–‡ä»¶æ—¶ï¼Œæ‰ä¼šä¸ºæ¯ä¸ªå—å½±å“çš„åŒ…è¿›è¡Œ**ç‰ˆæœ¬æå‡**ï¼ˆåŸºäºæ¯ä¸ªåŒ…çš„æœ€å¤§ç‰ˆæœ¬æå‡ï¼‰ï¼Œå¹¶ä¸”è¿˜ä¼šåœ¨æ¯ä¸ªåŒ…çš„æ ¹ç›®å½•ä¸‹åˆ›å»ºï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰ä¸€ä¸ª **CHANGELOG.md** çš„æ–‡ä»¶ï¼Œä»¥è¿½åŠ çš„æ–¹å¼å†™å…¥å˜æ›´çš„æ—¥å¿—ï¼ˆæ‘˜è¦å†…å®¹ï¼‰ï¼Œå¹¶åœ¨éœ€è¦çš„æ—¶å€™åŒæ—¶æ›´æ–°ä¾èµ–çš„ç‰ˆæœ¬ã€‚

æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œä¾¿å¯ä»¥æ¶ˆè€—æ‰€æœ‰å˜æ›´é›†æ–‡ä»¶ï¼š

```shell
npm run changeset version
```

å˜æ›´é›†æ–‡ä»¶ä¸€æ—¦æ¶ˆè€—å°±ä¼šè¢«åˆ é™¤ï¼Œå› æ­¤æ¯ä¸ªå˜æ›´é›†æ–‡ä»¶åªä¼šè¢«ä½¿ç”¨ä¸€æ¬¡ã€‚

![[changeset-version.svg]]

### å‘å¸ƒå˜æ›´

æ‰§è¡Œä¸‹é¢å‘½ä»¤ï¼ŒChangesets ä¼šå¯¹æ¯”åŒ…çš„æœ¬åœ°ç‰ˆæœ¬ä¸ registry ä¸Šçš„ç‰ˆæœ¬ï¼Œä¸€æ—¦ registry ä¸Šæ²¡æœ‰ï¼Œå°±ä¼šè°ƒç”¨åŒ…ç®¡ç†çš„ `publish` å‘½ä»¤å‘å¸ƒåŒ…ï¼›å¦‚æœå·²ç»å­˜åœ¨ï¼Œå°±ä¸ä¼šå†å‘å¸ƒåŒ…äº†ã€‚
```shell
npm run changeset publish
```

### ç»„åˆå˜æ›´é›†æ–‡ä»¶

å˜æ›´é›†æ–‡ä»¶æ˜¯å¯å †å çš„ï¼Œå¯ä»¥å°†ä»»æ„æ•°é‡çš„å˜æ›´é›†åˆå¹¶ä¸ºä¸€ä¸ªå‘å¸ƒï¼Œ`Changesets` ä¼šå‹å¹³æ¯ä¸ªåŒ…çš„ç‰ˆæœ¬æå‡ç±»å‹ï¼ˆæ¯ä¸ªç‰ˆæœ¬ç±»å‹åªä¼šè¢«æå‡ä¸€æ¬¡ï¼‰ã€‚

* å¤šä¸ª `patch` åˆå¹¶æˆä¸€ä¸ª `patch` æå‡ã€‚
* å¤šä¸ª `patch`ï¼Œä¸€ä¸ª `minor`ï¼Œåˆå¹¶ä¸ºä¸€ä¸ª `minor`ã€‚
* å¤šä¸ª `patch`ï¼Œå¤šä¸ª `minor`ï¼Œä¸€ä¸ª `major`ï¼Œåˆå¹¶ä¸ºä¸€ä¸ª `major` æå‡ã€‚
* å¤šä¸ª `major` åˆå¹¶ä¸ºä¸€ä¸ª `major`ã€‚

## ä¾èµ–å˜æ›´

>[!warning]
>ä»¥ä¸‹è¡Œä¸ºä»…ä½œç”¨äº **Monorepo** ä»“åº“ä¸­ã€‚åªæœ‰åœ¨å•ä»“ä¸­æ‰ä¼šå˜æ›´å…·æœ‰ä¾èµ–å…³ç³»çš„å­åŒ…ã€‚

Changesets æœ‰å…³å…·æœ‰ä¾èµ–å…³ç³»åŒ…çš„å˜æ›´ç­–ç•¥å¦‚ä¸‹ï¼š

**â€œä¾èµ–è€…åŒ…â€ä¸â€œä¾èµ–åŒ…â€çš„å®šä¹‰ï¼**
å¦‚æœ A åŒ…ä¾èµ–äº† B åŒ…ï¼š
- å¯¹äº A åŒ…è€Œè¨€ï¼ŒB åŒ…æ˜¯å®ƒçš„ â€”â€” â€œä¾èµ–åŒ…â€ã€‚
- å¯¹äº B åŒ…è€Œè¨€ï¼ŒA åŒ…æ˜¯å®ƒçš„ â€”â€” â€œä¾èµ–è€…åŒ…â€
ç”¨â€œå‘å¸ƒ/è®¢é˜…æ¨¡å¼â€å»ç†è§£ï¼š
- B åŒ…æ˜¯æä¾›è€…ã€‚
- A åŒ…åˆ™æ˜¯æ¶ˆè´¹è€…ã€‚

**ä»€ä¹ˆåœºæ™¯ä¸‹ Changesets ä¼šè‡ªåŠ¨å˜æ›´â€œä¾èµ–è€…åŒ…â€ï¼Ÿ**
1. å½“å•ä»“çš„**æŸä¸ªè¢«ä¾èµ–åŒ…**å­˜åœ¨é‡å¤§çš„ç‰ˆæœ¬å˜æ›´æ—¶ï¼ŒChangesets ä¼šæ£€æŸ¥ä¾èµ–å®ƒçš„å…¶å®ƒåŒ…æ˜¯å¦å­˜åœ¨è¶…å‡ºè¯­ä¹‰ç‰ˆæœ¬æ§åˆ¶èŒƒå›´ï¼ˆä¹Ÿå°±æ˜¯ä¸èƒ½åŒ¹é…åˆ°æ‰€ä¾èµ–åŒ…çš„æœ€æ–°ç‰ˆæœ¬ï¼‰çš„æƒ…å†µï¼Œå¦‚æœå­˜åœ¨ï¼ŒChangesets ä¼šä»¥ `patch` çš„æ–¹å¼è‡ªåŠ¨æ›´æ–°æ‰€æœ‰ä¾èµ–è€…åŒ…ï¼Œå¹¶å°†ä¾èµ–æ›´æ–°æ—¥å¿—å†™å…¥åˆ°ä¾èµ–è€…åŒ…çš„ CHANGELOG.md æ–‡ä»¶ä¸­ã€‚
	ä¾‹å¦‚ ï¼š`pkg-a` ä¾èµ–äº† `pkg-b:^1.0.0`ï¼Œå½“ `pkg-b` äº§ç”Ÿ bump major æ—¶ï¼ŒChangesets ä¼šä»¥ `patch` çš„æ–¹å¼è‡ªåŠ¨æ›´æ–° `pkg-a` åŒ…ã€‚

2. å½“å•ä»“åŒæ—¶å­˜åœ¨**å¤šä¸ªå˜æ›´åŒ…**æ—¶ï¼Œå¯¹äºå…·æœ‰ä¾èµ–å…³ç³»çš„åŒ…ï¼Œä¼šä¸ºä¾èµ–è€…åŒ…é¢å¤–å¢åŠ ä¸€ä¸ª `patch` çº§åˆ«çš„ç‰ˆæœ¬å˜æ›´ï¼ŒåŒæ—¶å°†ä¾èµ–æ›´æ–°æ—¥å¿—å†™å…¥åˆ°ä¾èµ–è€…åŒ…çš„ CHANGELOG.md æ–‡ä»¶ä¸­ã€‚
	ä¾‹å¦‚ ï¼š`pkg-a` ä¾èµ–äº† `pkg-b`ï¼Œå½“åŒæ—¶å˜æ›´äº† `pkg-a` ä¸ `pkg-b` æ—¶ï¼Œä¼šä¸º `pkg-a` é¢å¤–è¿½åŠ ä¸€ä¸ª `patch` å¹¶ç”Ÿæˆä¾èµ–çš„æ›´æ–°æ—¥å¿—ã€‚ ^a005e5


**ä¸ºä»€ä¹ˆå½“ä¾èµ–åŒ…è¶…å‡ºè¯­ä¹‰ç‰ˆæœ¬æ§åˆ¶èŒƒå›´æ—¶éœ€è¦å¼ºè¡Œå¯¹â€œä¾èµ–è€…åŒ…â€è¿›è¡Œå˜æ›´ï¼Ÿ**
	å› ä¸ºåœ¨ Monorepo ä¸­å…·æœ‰ä¾èµ–å…³ç³»çš„å¤šä¸ªå­åŒ…ï¼Œå…¶åº•å±‚éƒ½æ˜¯ä»¥ç›¸å¯¹ä½ç½®å¼•å…¥çš„ï¼Œå¦‚æœä¾èµ–è€…åŒ…çš„è¯­ä¹‰ç‰ˆæœ¬èŒƒå›´æ— æ³•åŒ¹é…åˆ°è¢«ä¾èµ–åŒ…çš„æœ€æ–°ç‰ˆæœ¬ï¼Œé‚£ä¹ˆâ€œåŒ…ç®¡ç†å™¨â€å°±å¯èƒ½ä¼šæ‹’ç»è¢«ä¾èµ–åŒ…çš„è½½å…¥ï¼Œå› æ­¤å°±å¿…é¡»è¦åœ¨æ­¤ç§æƒ…å†µä¸‹å¯¹ä¾èµ–è€…åŒ…è¿›è¡Œè‡ªåŠ¨æ£€æŸ¥å¹¶æ›´æ–°ï¼Œä»¥ç¡®ä¿ä¾èµ–å…³ç³»çš„æ­£ç¡®æ€§ã€‚

**èƒ½å¦å¿½ç•¥ Changesets çš„è‡ªåŠ¨æ£€æŸ¥å’Œæ›´æ–°æœºåˆ¶ï¼Ÿ**
	æœ‰çš„ã€‚
	å¯¹äº npm å¯ä»¥å°†ä¾èµ–åŒ…çš„ç‰ˆæœ¬æ§åˆ¶èŒƒå›´ä¿®æ”¹ä¸ºï¼š`pkg-b:*`ã€‚
	å¯¹äº pnpm åˆ™å¯ä»¥ä¿®æ”¹ä¸ºï¼š`pkg-b:workspace:*` ã€‚

## èƒŒåç†å¿µ

æŒ‰ç…§å®˜æ–¹æ–‡æ¡£ä¸­ç»™å‡ºçš„æœ‰å…³ `Changesets` èƒŒåçš„ç†å¿µï¼Œå®ƒä¸»è¦æ˜¯ä¸ºäº†è§£å†³ä»¥ä¸‹ä¸¤ä¸ªé—®é¢˜è¢«è®¾è®¡å‡ºæ¥çš„ï¼š
1. åœ¨ Git ä¸­ä¸èƒ½å¾ˆæ–¹ä¾¿çš„è®°å½•è¯¦ç»†çš„å˜æ›´æ—¥å¿—ã€‚
2. è®°å½•æ—¥å¿—çš„æœ€ä½³æ—¶æœºæ˜¯åœ¨æäº¤ `PR` æ—¶ï¼ˆæ­¤æ—¶è®°å¿†çŠ¹æ–°ï¼‰ï¼Œè€Œä¸æ˜¯åœ¨æœ€ç»ˆå‘ç‰ˆæ—¶ã€‚

å¯¹æ­¤ï¼Œ`Changesets` æå‡ºäº†åˆ›å»ºâ€œå˜æ›´é›†â€æ–‡ä»¶çš„æ–¹æ¡ˆã€‚å˜æ›´é›†æ–‡ä»¶è®°å½•äº†æœ‰å…³å˜æ›´çš„æ—¥å¿—ä¿¡æ¯å’Œç‰ˆæœ¬ç±»å‹ã€‚é€šè¿‡å°†â€œå˜æ›´é›†â€æ–‡ä»¶å­˜å‚¨åœ¨æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿï¼Œä»¥è§£å†³ Git å­˜å‚¨åº“çš„é™åˆ¶ã€‚åœ¨æäº¤äº§ç‰©æ—¶ï¼ŒéšåŒ `PR` ä¸€èµ·æäº¤åˆ°è¿œç¨‹å­˜å‚¨åº“ï¼Œæœ€ååœ¨æ°å½“çš„æ—¶æœºå»æ¶ˆè€—è¿™äº›å˜æ›´é›†æ–‡ä»¶ï¼Œä»è€Œå®ç°â€œç‰ˆæœ¬æå‡â€å’Œâ€œæ—¥å¿—å˜æ›´â€çš„æ“ä½œã€‚

å˜æ›´é›†æ–‡ä»¶çš„ç‰ˆæœ¬ç±»å‹éµå¾ªäº†è¯­ä¹‰åŒ–ç‰ˆæœ¬æ§åˆ¶([semver](https://semver.org/lang/zh-CN/))çš„æ ‡å‡†ï¼Œå¯¹äºæ ‡å‡†å‘è¡Œç‰ˆï¼š
* `major` ï¼šä¸»ç‰ˆæœ¬
* `minor` ï¼šæ¬¡ç‰ˆæœ¬
* `patch` ï¼šè¡¥ä¸ç‰ˆæœ¬

å¯¹äºâ€œé¢„å‘è¡Œç‰ˆâ€ï¼ˆä¹Ÿå«å…ˆè¡Œç‰ˆæœ¬ï¼‰ï¼Œä»¥ä¸Šç‰ˆæœ¬ç±»å‹ä¾ç„¶é€‚ç”¨ã€‚ä½†éœ€è¦ä¸“é—¨çš„å‘½ä»¤é€‰é¡¹è¿›å…¥/é€€å‡ºâ€œé¢„å‘è¡Œæ¨¡å¼â€ã€‚

## å·¥ä½œæµç¨‹

`Changests` çš„å·¥ä½œæµç¨‹å¾ˆç®€å•ï¼š

1. æ¯æ¬¡å˜æ›´éƒ½ä½¿ç”¨ `changeset add` åˆ›å»ºå˜æ›´é›†æ–‡ä»¶ã€‚
2. å‡†å¤‡å‘å¸ƒæ—¶è¿è¡Œ `changeset version` æ¶ˆè€—å˜æ›´é›†æ–‡ä»¶ã€‚
3. éªŒè¯æ— è¯¯å,å°†å˜æ›´åˆå¹¶åˆ°ä¸»çº¿åˆ†æ”¯ã€‚
4. æœ€åæ‰§è¡Œ `changeset publish` å‘å¸ƒå˜æ›´çš„åŒ…ã€‚

å¤§è‡´æ­¥éª¤ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![[changesets-steps.svg]]

ä½†æ˜¯ï¼Œè¦è¦ç†è§£ Changesets å·¥ä½œæµç¨‹ä¸­è•´å«çš„çœŸå®æ„å›¾ï¼Œåˆ™å¿…é¡»è¦å°†å˜æ›´é›†æ–‡ä»¶çš„åˆ›å»ºä¸æ¶ˆè€—åŒºåˆ†å¼€æ¥çœ‹ã€‚â€œå˜æ›´é›†â€æ–‡ä»¶ä¸€ç§æ˜¯å«æœ‰å˜æ›´æ„å›¾çš„æ–‡ä»¶ï¼Œå®ƒåŒ…å«äº†ä¸¤éƒ¨åˆ†å†…å®¹ï¼šâ€œè¦æå‡ç‰ˆæœ¬çš„ç±»å‹â€å’Œâ€œè¦è®°å½•çš„å˜æ›´ä¿¡æ¯â€ã€‚åªæœ‰æ¶ˆè€—å˜æ›´é›†æ–‡ä»¶ï¼Œæ‰ä¼šå®é™…è¿›è¡Œç‰ˆæœ¬æå‡å’Œæ—¥å¿—è®°å½•ã€‚å› æ­¤ï¼Œè¿™ç§è®¾è®¡å¾ˆå®¹æ˜“å›´ç»•â€œå˜æ›´é›†â€æ–‡ä»¶ï¼Œå°†å˜æ›´æµç¨‹åˆ†æ´¾ç»™ä¸åŒèŒè´£çš„è§’è‰²å»å®Œæˆï¼š
* `Developer` åœ¨å˜æ›´æ—¶åˆ›å»ºå˜æ›´é›†æ–‡ä»¶ï¼Œå¹¶éšåŒ `PR` ä¸€èµ·æäº¤ã€‚
* `Maintainer` åœ¨é€‚åˆçš„æ—¶æœºæ¶ˆè€—å˜æ›´é›†æ–‡ä»¶ï¼Œç¡®è®¤æ— è¯¯åï¼Œå‘å¸ƒå˜æ›´ç‰ˆæœ¬ã€‚

é€šå¸¸è€Œè¨€ï¼Œåä¸¤ä¸ªæ­¥éª¤å¯äº¤ç”± CI å®Œæˆï¼Œé¡¹ç›®çš„ Maintainer åªéœ€è¦å®Œæˆå®¡æ‰¹å³å¯ã€‚ä¸‹é¢æ˜¯æŒ‰èŒè´£åŒºåˆ†çš„ Changesets å·¥ä½œæµç¨‹ï¼š

![[how_dose_changesets_work.svg]]

> [!tip]
> ç”±äº Changesets  åªä¸“æ³¨äºå‘å¸ƒå’Œå˜æ›´çš„ç‰ˆæœ¬å’Œæ—¥å¿—,å¯¹äºä»“åº“çš„æ›´æ”¹å¦‚æœä¸éœ€è¦è¿™äº›å°±æ— éœ€æ·»åŠ  changesetã€‚æ‰€ä»¥,æˆ‘ä»¬å»ºè®®åœ¨ç¼ºå°‘ changeset çš„æƒ…å†µä¸‹,ä¸åº”å½“ä¸€å‘³çš„å»é˜»æ­¢åˆå¹¶è¯·æ±‚ã€‚

## å…¶å®ƒç‰¹æ€§

### å›ºå®šåŒ…

>[!tip]
>é€‚ç”¨äºä¸€ç»„åŒ…åŒæ—¶è¿›è¡Œå˜æ›´å’Œå‘å¸ƒã€‚

ä¸€ç»„åŒ…å…±äº«åŒä¸€å¥—ç‰ˆæœ¬æ§åˆ¶å’Œå‘å¸ƒæµç¨‹ï¼Œå³ä½¿å…¶ä¸­ä¸€äº›åŒ…æ²¡æœ‰åšä»»ä½•å˜æ›´ã€‚
åœ¨ `.changeset/config.json` æ–‡ä»¶ä¸­é€šè¿‡ `fixed` å­—æ®µå£°æ˜ä¸€ç»„å›ºå®šçš„åŒ…ã€‚
```json
{
	"fixed":[["pkg-a","pkg-b"]]
}
```

å‡è®¾æœ‰ä¸€äº›åŒ…ï¼Œå…¶ä¸­ `pkg-a` ä¸ `pkg-b` æ˜¯ä¸€ç»„â€œå›ºå®šåŒ…â€ï¼Œ`pkg-c`ä¸æ˜¯ã€‚å®ƒä»¬å½“å‰çš„ç‰ˆæœ¬å¦‚ä¸‹ï¼š
- `pkg-a@1.0.0`
- `pkg-b@1.0.0`
- `pkg-c@1.0.0`

ç°åœ¨åˆ›å»ºå˜æ›´é›†æ–‡ä»¶ï¼Œå¯¹ `pkg-a` è¿›è¡Œè¡¥ä¸å˜æ›´ï¼Œ`pkg-b` è¿›è¡Œæ¬¡ç‰ˆæœ¬å˜æ›´ï¼Œ`pkg-c` è¿›è¡Œä¸»ç‰ˆæœ¬å˜æ›´ï¼Œç„¶åæ¶ˆè€—å˜æ›´é›†å¹¶å‘å¸ƒï¼Œç»“æœç‰ˆæœ¬æƒ…å†µå¦‚ä¸‹ï¼š
* `pkg-a@1.1.0`
* `pkg-b@1.1.0`
* `pkg-c@2.0.0`

ç»§ç»­åˆ›å»ºå˜æ›´é›†æ–‡ä»¶ï¼Œåªå¯¹ `pkg-a` è¿›è¡Œå°ç‰ˆæœ¬å˜æ›´ï¼Œç„¶åå‘å¸ƒï¼Œç‰ˆæœ¬æƒ…å†µå¦‚ä¸‹ï¼š
* `pkg-a@1.2.0`
* `pkg-b@1.2.0`
* `pkg-c@2.0.0`

**glob è¡¨è¾¾å¼åŒ¹é…**

`fixed` å­—æ®µæ”¯æŒä½¿ç”¨ `glob` è¡¨è¾¾å¼åŒ¹é…ç‰¹å®šæ¨¡å¼çš„åŒ…ã€‚
```json
"fixed":[["pkg-*"]]
```

### è”åŠ¨åŒ…

>[!tip]
>é€‚ç”¨äºâ€œæ ¸å¿ƒåŒ…â€å’Œä¸€ç»„ä¾èµ–å…¶çš„â€œæ’ä»¶åŒ…â€ã€‚

å¯¹ä¸€ç»„åŒ…è¿›è¡Œç‰ˆæœ¬æ§åˆ¶ï¼Œä¸â€œå›ºå®šåŒ…â€ä¸åŒä¹‹å¤„åœ¨äºï¼š
1. å…è®¸è”åŠ¨åŒ…é›†ä¸­çš„åŒ…å•ç‹¬å˜æ›´ï¼ˆåªé™æ‹¥æœ‰å˜æ›´é›†çš„åŒ…æ‰èƒ½è¿›è¡Œå˜æ›´ï¼‰ã€‚ ^f80c51
2. å…è®¸è”åŠ¨åŒ…é›†ä¸­çš„åŒ…å•ç‹¬å‘å¸ƒã€‚
3. å½“è”åŠ¨åŒ…é›†ä¸­çš„ä¸€äº›åŒ…åŒæ—¶å˜æ›´æ—¶ï¼Œä¼šç”¨å…¶ä¸­ç‰ˆæœ¬æå‡æœ€é«˜çš„å“ªä¸ªåŒ…çš„ç‰ˆæœ¬ä½œä¸ºå…¶å®ƒåŒ…æœ€ç»ˆè¦æå‡çš„ç‰ˆæœ¬ã€‚ ^659c15

ä½¿ç”¨ `linked` å­—æ®µå¯ä»¥å®šä¹‰ä¸€ç»„â€œè”åŠ¨åŒ…â€ï¼š
```json
{
	"linked":[["core", "plugin-a", "plugin-b"]]
}
```

`plugin-a` ä¸ `plugin-b` ä¾èµ– `core`ï¼Œç‰ˆæœ¬æƒ…å†µå¦‚ä¸‹ï¼š
* `core@1.0.0`
* `plugin-a@1.0.0`
* `plugin-b@1.0.0`

åˆ›å»ºå˜æ›´é›†æ–‡ä»¶ï¼Œ `plugin-a` è¡¥ä¸å˜æ›´ï¼Œç°åœ¨ç‰ˆæœ¬æƒ…å†µå¦‚ä¸‹:
* `core@1.0.0`
* `plugin-a@1.0.1`*ï¼ˆæ»¡è¶³ [[#^f80c51]]ï¼‰*
* `plugin-b@1.0.0`

åˆ›å»ºå˜æ›´é›†æ–‡ä»¶ `plugin-a` è¡¥ä¸å˜æ›´ï¼Œ`plugin-b` æ¬¡ç‰ˆæœ¬å˜æ›´ï¼Œç°åœ¨ç‰ˆæœ¬æƒ…å†µå¦‚ä¸‹ï¼š
* `core@1.0.0`
* `plugin-a@1.1.0`*ï¼ˆæ»¡è¶³ [[#^659c15]]ï¼‰*
* `plugin-b@1.1.0`*ï¼ˆæ»¡è¶³ [[#^659c15]]ï¼‰*

åˆ›å»ºå˜æ›´é›†ï¼Œæ ¸å¿ƒåŒ… `core` è¿›è¡Œä¸»ç‰ˆæœ¬å˜æ›´,ç°åœ¨çš„ç‰ˆæœ¬æƒ…å†µå¦‚ä¸‹ï¼ˆä¾èµ–è€…åŒ…ä¹Ÿæ»¡è¶³ [[#^659c15]]ï¼‰ï¼š
* `core@2.0.0`
* `plugin-a@2.0.0`
* `plugin-b@2.0.0`

ä¸ â€œå›ºå®šåŒ…â€ç›¸åŒï¼Œè”åŠ¨åŒ…ä¹Ÿæ”¯æŒ `glob` åŒ¹é…æ¨¡å¼ï¼š
```json
{
	"linked": [["core","plugin-*"]]
}
```
 
### å¿«ç…§å‘å¸ƒ

å¿«ç…§ç‰ˆæœ¬ä¸»è¦ç”¨äºéªŒè¯å’Œæµ‹è¯•ã€‚éå¸¸ç±»ä¼¼ä¸â€œé¢„å‘è¡Œç‰ˆâ€ï¼Œä½†åˆæ²¡æœ‰åè€…å¤æ‚çš„ç‰ˆæœ¬æå‡è§„åˆ™ã€‚
åˆ›å»ºå¿«ç…§å‘å¸ƒï¼Œåªéœ€åœ¨æ‰§è¡Œ `version` å‘½ä»¤æ—¶æ·»åŠ ä¸€ä¸ª `--snapshot` å‚æ•°å³å¯ã€‚
```shell
npm run changeset version -- --snapshot
```

Changesets é»˜è®¤ä¼šåœ¨å½“å‰çš„ç‰ˆæœ¬å·çš„åŸºç¡€ä¸Šå†æ·»åŠ æ—¶é—´æˆ³åç¼€æ¥ç”Ÿæˆå¿«ç…§ç‰ˆæœ¬ã€‚ä¾‹å¦‚å½“å‰çš„ç‰ˆæœ¬æ˜¯ `core@3.0.0`ï¼Œåœ¨è¿›è¡Œç‰ˆæœ¬æå‡ååˆ™ä¸ºï¼š`core@3.0.0-20240830025246`ã€‚

å¿«ç…§ç‰ˆæœ¬æ”¯æŒæ·»åŠ  `tag`ï¼Œä»¥å¢å¼ºç‰ˆæœ¬å·çš„ä¸ªæ€§åŒ–ã€‚
```shell
npm run changeset version -- --snaphost canary
# `core@3.0.0-canary-20240830025246`
```

æœ€åä¾¿æ˜¯å‘å¸ƒå¿«ç…§ç‰ˆæœ¬:
```shell
npm run changeset publish -- --tag cannary --no-git-tag
```
`--tag` å‚æ•°å¯ä»¥ç”¨è‡ªå®šä¹‰çš„â€œåˆ†å‘æ ‡ç­¾â€å‘å¸ƒåˆ° npm ä¸Šï¼Œè€Œä¸æ˜¯è¦†ç›–é»˜è®¤çš„ `latest` æ ‡ç­¾ï¼Œè¿™éå¸¸é‡è¦ã€‚
`--no-git-tag` è·³è¿‡ä¸ºå¿«ç…§åŒ…åˆ›å»º git æ ‡ç­¾ï¼ˆåªæœ‰ç¨³å®šç‰ˆæœ¬æ˜¯æ‰æœ‰ï¼Œè¿™æ˜¯é»˜è®¤è¡Œä¸ºï¼‰ã€‚

>[!warning]
>â€œå¿«ç…§ç‰ˆæœ¬â€ä¸æ˜¯â€œç¨³å®šç‰ˆæœ¬â€ã€‚å› æ­¤ä¸å»ºè®®å°†æ›´æ”¹åˆå¹¶åˆ°ä¸»åˆ†æ”¯ä¸Šï¼Œä½ å¯ä»¥å•ç‹¬ç”¨ä¸€ä¸ªåˆ†æ”¯å»ä¿å­˜å¿«ç…§çš„ç‰ˆæœ¬å’Œæ ‡ç­¾ï¼Œä½†è®°ä½ï¼Œæ°¸è¿œä¹Ÿä¸è¦å°†è¿™ä¸ªåˆ†æ”¯åˆå¹¶åˆ°ä¸»åˆ†æ”¯ä¸Šã€‚

### é¢„å‘è¡Œç‰ˆ

é¢„å‘è¡Œç‰ˆéå¸¸å¤æ‚ï¼ŒChangesets ä¸“é—¨ç”¨ä¸¤ç§å˜æ›´æ¨¡å¼æ¥åŒºåˆ†â€œé¢„å‘è¡Œç‰ˆâ€å’Œâ€œç¨³å®šç‰ˆâ€ã€‚

æƒ³è¦å‘å¸ƒé¢„å‘è¡Œç‰ˆï¼Œå¿…é¡»è¦å…ˆè¿›å…¥â€œé¢„å‘å¸ƒæ¨¡å¼â€ï¼š
```shell
npm run changeset pre enter alpha
```
* `pre enter` æ˜¯è¿›å…¥é¢„å‘å¸ƒæ¨¡å¼çš„å‘½ä»¤å…³é”®å­—ã€‚
* `alpha` æ˜¯ä¸€ä¸ªæ ‡ç­¾ï¼Œåœ¨æœ€åå‘å¸ƒæ—¶ä¼šè¢«ç”¨åšâ€œåˆ†å‘æ ‡ç­¾â€ã€‚

è¿›å…¥â€œé¢„å‘å¸ƒæ¨¡å¼â€åï¼ŒChangesets ä¼šåœ¨ `.changeset` ç›®å½•ä¸‹åˆ›å»ºä¸€ä¸ª `pre.json` çš„æ–‡ä»¶ï¼Œç”¨äºè®°å½•é¢„å‘è¡Œç‰ˆæœ¬çš„çŠ¶æ€å’Œä¿¡æ¯ã€‚
```markdown
{
  "mode": "pre",
  "tag": "beta",
  "initialVersions": {
    "core": "6.0.0",
    "pkg": "2.2.0",
    "plugin": "3.8.0"
  },
  "changesets": []
}
```

åœ¨é¢„å‘å¸ƒæ¨¡å¼ä¸‹æˆ‘ä»¬å¯ä»¥åƒä»¥å¾€é‚£æ ·ä½¿ç”¨ `changeset` å‘½ä»¤åˆ›å»ºå˜æ›´é›†æ–‡ä»¶ï¼›ä½¿ç”¨`changeset version` å‘½ä»¤æ¥æ¶ˆè€—å˜æ›´é›†æ–‡ä»¶æ¥å®ç°ç‰ˆæœ¬æå‡ä¸æ—¥å¿—è®°å½•ã€‚ä½†æœ‰ä¸€ç‚¹éå¸¸ä¸åŒï¼Œé‚£å°±æ˜¯**åœ¨é¢„å‘å¸ƒæ¨¡å¼ä¸‹æ¶ˆè€—å˜æ›´é›†æ–‡ä»¶å¹¶ä¸ä¼šå®é™…åˆ é™¤ `.changeset` ç›®å½•ä¸‹çš„å˜æ›´é›†æ–‡ä»¶**ã€‚

åœ¨â€œé¢„å‘å¸ƒæ¨¡å¼â€ä¸‹æ¶ˆè€—å˜æ›´é›†æ–‡ä»¶ä¼šé€’å¢é¢„å‘å¸ƒç‰ˆæœ¬è®¡æ•°ï¼Œå³ä»é»˜è®¤çš„ `-alpha.0` é€’å¢ä¸º `-alpha.1`

å½“éœ€è¦å‘å¸ƒé¢„å‘è¡Œç‰ˆæœ¬æ—¶ï¼Œæ­£å¸¸æ‰§è¡Œ `changeset publish` å‘½ä»¤å³å¯ï¼Œæ­¤æ—¶ `alpha` æ ‡ç­¾å°†ä¼šä½œä¸º NPM åŒ…çš„ dist æ ‡ç­¾å‘å¸ƒåˆ° Registry ä¸Šã€‚

ä»¥ä¸Šå¤§è‡´æ“ä½œçš„å¤§è‡´æµç¨‹å¯èƒ½å¦‚ä¸‹ï¼š
```shell
npm run changeset pre enter alpha

npm run changeset # create changeset files
npm run changeset version # alpha.0
npm run changeset # create changeset files
npm run changeset version # alpha.1

git add .
git add *
git commit -m 'feat: è¿›å…¥é¢„å‘å¸ƒæ¨¡å¼å‘å¸ƒ xxx-alpha.1 ç‰ˆæœ¬'
npm run changeset publish
git push --follow-tags

npm run changeset pre exit # exit pre mode
```

è‹¥æƒ³å†æ¬¡æœŸé—´å˜æ›´ tagï¼Œåªéœ€å…ˆé€€å‡ºé¢„å‘å¸ƒæ¨¡å¼ï¼Œç„¶åç”¨æ–°çš„ tag å†è¿›å…¥é¢„å‘å¸ƒæ¨¡å¼å³å¯ï¼š
```shell
npm run changeset pre exit
npm run changeset pre enter beta
```

å½“é¢„å‘è¡Œçš„æµç¨‹èµ°å®Œéœ€è¦å‘å¸ƒæœ€æ–°é˜¶æ®µçš„ç¨³å®šç‰ˆæ—¶ï¼Œä½ éœ€è¦é€€å‡ºé¢„å‘å¸ƒæ¨¡å¼ï¼Œç„¶åæ‰§è¡Œ `changeset version` å‘½ä»¤æ¥å®é™…æ¶ˆè€—å˜æ›´é›†æ–‡ä»¶ï¼ŒChangeset ä¹Ÿä¼šè‡ªåŠ¨åˆ é™¤ `pre.json` æ–‡ä»¶ã€‚
```shell
npm run changeset pre eixt
npm run changeset version

git add .
git add *
git commit -m 'feat: å‘å¸ƒæœ€æ–°é˜¶æ®µçš„æ­£å¼ç‰ˆæœ¬'

npm run changeset publish
git push --follow-tags
```
å‘å¸ƒå‘½ä»¤å°†åƒå¾€å¸¸ä¸€æ ·å°†æ‰€æœ‰å†…å®¹å‘å¸ƒåˆ°Â `latest`Â æ ‡ç­¾ä¸Šã€‚
## é…ç½®æ–‡ä»¶

è®¤è¯†ä¸€ä¸‹ `.changeset/config.json` é…ç½®æ–‡ä»¶ç›¸å…³çš„å­—æ®µï¼š

### commit

æ˜¯å¦è¦åœ¨æ‰§è¡Œ`changeset add` æˆ– `changeset version` å‘½ä»¤æ—¶è°ƒç”¨ `git add` ä¸ `git commit` å¹¶è‡ªåŠ¨ç”Ÿæˆæäº¤æ¶ˆæ¯ï¼Ÿ
é»˜è®¤æƒ…å†µä¸‹ï¼Œä¸ä¼šè‡ªåŠ¨æ·»åŠ ä¸æäº¤æ–‡ä»¶ï¼Œè€Œæ˜¯è®©ç”¨æˆ·æäº¤æ–‡ä»¶ã€‚
å–å€¼ï¼š
* å¸ƒå°”å€¼ï¼šè®¾ç½®ä¸º `true` æ—¶è‡ªåŠ¨æ‰§è¡Œ git æ·»åŠ ä¸æäº¤è¡Œä¸ºï¼Œå¹¶ä½¿ç”¨ Changeset é»˜è®¤æä¾›çš„ `cli/src/commit` æ¨¡å—ç”Ÿæˆæäº¤æ¶ˆæ¯ã€‚
* å­—ç¬¦ä¸²ç±»å‹ï¼šè‡ªå®šä¹‰ç”Ÿæˆæäº¤æ¶ˆæ¯çš„æ¨¡å—è·¯å¾„ã€‚è¯¥æ¨¡å—éœ€è¦å¯¼å‡ºä¸¤ä¸ªå‡½æ•°ï¼š`getAddMessage` ä¸ `getVersionMessage` ç”¨äºæ‰§è¡Œ `changeset add` æˆ– `changeset version` å‘½ä»¤æ—¶ç”Ÿæˆè‡ªå®šä¹‰çš„ git æäº¤æ¶ˆæ¯ã€‚
* æ•°ç»„ç±»å‹ï¼šè‡ªå®šä¹‰ç”Ÿæˆæäº¤æ¶ˆæ¯çš„æ¨¡å—è·¯å¾„å¹¶å¯ä»¥è‡ªå®šä¹‰é€‰é¡¹ã€‚
* é»˜è®¤å€¼ä¸ºï¼š`false`ã€‚

ä¸‹é¢æ˜¯è‡ªå®šä¹‰ç”Ÿæˆæäº¤æ¶ˆæ¯çš„ç”¨ä¾‹ï¼š
```json
{
  "commit":["../.changeset/commit.js", {"skipCI":"add"}]
}
```

é€‰é¡¹ä¸­çš„ `skipCI` å‚æ•°ä¼šç”¨äº git commit message ä¸­ `[skip ci]` å ä½ç¬¦çš„ç”Ÿæˆï¼Œä»¥æ§åˆ¶ CI ç³»ç»Ÿæ˜¯å¦è¦è·³è¿‡è¯¥æäº¤çš„æ„å»ºæµç¨‹ã€‚

	chore(release): publish new version [skip ci]

æ¨¡å—ä¸­å¯¼å‡ºçš„ `getAddMessage` ä¸ `getVersionMessage` å‡½æ•°å…·ä½“å®ç°å¯ä»¥å‚è€ƒå®˜æ–¹ç¤ºä¾‹ï¼š[commit](https://github.com/changesets/changesets/blob/main/packages/cli/src/commit/index.ts)
### access

è®¾ç½® Changesets å‘ Registry ä¸Šçš„å‘åŒ…æ–¹å¼ã€‚
å–å€¼ï¼š
- `restricted`: ç§æœ‰åŒ…ã€‚
- `public`: å…¬å…±åŒ…ã€‚
- é»˜è®¤å€¼ï¼š`restricted`ã€‚ä¸»è¦æ˜¯é˜²æ­¢ç”¨æˆ·æ„å¤–æ“ä½œã€‚

### baseBranch

è®¾ç½® Changesets å·¥ä½œçš„åˆ†æ”¯ï¼š
å–å€¼ï¼š
* é»˜è®¤å€¼ï¼š`main`ã€‚

### ignore

å¿½ç•¥è¦å‘å¸ƒçš„åŒ…ã€‚å»ºè®®ä½¿ç”¨ `package.json` æ–‡ä»¶çš„ `private` å­—æ®µã€‚
å–å€¼ï¼š
- åŒ…åçš„å­—ç¬¦ä¸²æ•°ç»„ã€‚

### fixed

æŒ‡å®šä¸€ç»„å›ºå®šåŒ…ã€‚å…±äº«åŒä¸€å¥—è¯­ä¹‰ç‰ˆæœ¬æ§åˆ¶ä¸å‘åŒ…æµç¨‹ã€‚
å–å€¼ï¼š
- åŒ…åçš„äºŒç»´æ•°ç»„ã€‚

### linked

æŒ‡å®šä¸€ç»„è”ç»“åŒ…ã€‚å…±äº«åŒä¸€å¥—è¯­ä¹‰ç‰ˆæœ¬æ§åˆ¶ï¼Œä½†æ˜¯å…è®¸å•ç‹¬æå‡ç‰ˆæœ¬ä¸å‘å¸ƒã€‚
å–å€¼ï¼š
- åŒ…åçš„äºŒç»´æ•°ç»„ã€‚

### updateInternalDependencies

æ§åˆ¶ä¾èµ–è€…åŒ…ç‰ˆæœ¬æå‡æ—¶çš„æå‡ç±»å‹ï¼ˆè¯¦ç»†æè¿°ï¼š[[#^a005e5]]ï¼‰
å–å€¼ï¼š
- é»˜è®¤å€¼ï¼š`patch` 

### changelog

è®¾ç½®å˜æ›´æ—¥å¿—çš„ç”Ÿæˆæ–¹å¼ã€‚Changesets é»˜è®¤ä½¿ç”¨ `@changesets/changelog-git` åŒ…æ¥ç”Ÿæˆå˜æ›´æ—¥å¿—ã€‚

é™¤æ­¤ä¹‹å¤–ï¼Œå¯¹äº `GitHub` çš„é¡¹ç›®ï¼Œå®˜æ–¹è¿˜æä¾›äº† `@changesets/changelog-github` çš„å¯é€‰åŒ…ã€‚ä¸“é—¨ç”¨äºç”Ÿæˆ GithHub ä¸‹çš„å˜æ›´æ—¥å¿—ã€‚

å¼€å‘è€…ä¹Ÿå¯ä»¥è‡ªå®šä¹‰å˜æ›´æ—¥å¿—çš„ç”Ÿæˆé€»è¾‘ï¼Œè¿™éœ€è¦ç¼–å†™ä¸€ä¸ªæ¨¡å—ï¼Œå¹¶å¯¼å‡ºä¸¤ä¸ªåä¸º `getReleaseLine` ä¸ `getDependencyReleaseLine` æ–¹æ³•ã€‚

å–å€¼ï¼š
* å¸ƒå°”å€¼ï¼š `false` è¡¨ç¤ºä¸ç”Ÿæˆå˜æ›´æ—¥å¿—ã€‚
* å­—ç¬¦ä¸²ï¼š æ¨¡å—çš„è·¯å¾„ã€‚
* æ•°ç»„ï¼šæ¨¡å—çš„è·¯å¾„ä¸é€‰é¡¹ã€‚
* é»˜è®¤å€¼ï¼š`"@changesets/cli/changelog"`

ç¤ºä¾‹ï¼š
```json
{
	"changelog":["@changesets/changelog-github", {"repo": "xxx"}]
}
```

### bumpVersionsWithWorkspaceProtocolOnly

ç¡®å®š Changesets æ˜¯å¦ä»…æ›´æ–°ä½¿ç”¨å·¥ä½œåŒºåè®®ä¸”å±äºå·¥ä½œåŒºçš„åŒ…çš„ä¾èµ–èŒƒå›´ã€‚

### snapshot

- `useCalculatedVersion`
	- æŒ‡å®šå¿«ç…§ç‰ˆæœ¬çš„åŸºç¡€ç‰ˆæœ¬ï¼Œé»˜è®¤ `0.0.0` ã€‚
- `prereleaseTemplate`: 
	- è‡ªå®šä¹‰å¿«ç…§ç‰ˆæœ¬çš„åç¼€ã€‚
	- å¯ä»¥ä½¿ç”¨çš„å ä½ç¬¦æœ‰ï¼š`{tag}`ã€`{commit}`ã€`{timestamp}`ã€`{datetime}`ã€‚
	- é»˜è®¤å ä½ç¬¦ä¸ºï¼š`{tag}-{datetime}` ã€‚

### schema
æ›´å¤šçš„é…ç½®å­—æ®µå’Œç›¸å…³è¯´æ˜å¯ä»¥æŸ¥é˜… [schema](https://unpkg.com/@changesets/config@3.0.2/schema.json) æ–‡ä»¶ï¼š

## å‘½ä»¤ä¸é€‰é¡¹

å‘½ä»¤è¡Œæ˜¯ä¸ Changesets äº¤äº’çš„ä¸»è¦æ–¹å¼ã€‚
ä¸‹é¢æ˜¯ Changesets æä¾›çš„å…¨éƒ¨å‘½ä»¤ï¼Œä½†ä¸»è¦å‘½ä»¤åªæœ‰å››ä¸ªï¼š
- `init`
- `add`
- `version`
- `publish`

### init

åˆå§‹åŒ–é¡¹ç›®ï¼Œè¯¥å‘½ä»¤åªéœ€è¦æ‰§è¡Œä¸€æ¬¡ã€‚
æ­¤å‘½ä»¤ä¼šåœ¨é¡¹ç›®æ ¹ç›®å½•åˆ›å»º `.changeset` éšè—ç›®å½•ï¼Œå¹¶ç”Ÿæˆé…ç½®æ–‡ä»¶ã€è‡ªè¿°æ–‡ä»¶ã€‚

### add

åˆ›å»ºå˜æ›´é›†æ–‡ä»¶ã€‚
```shell
changeset add
#æˆ–
changeset 
```

æ­¤å‘½ä»¤ä¼šä»¥äº¤äº’é—®å·çš„æ–¹å¼è·å–å˜æ›´çš„åŒ…ã€è¦æå‡çš„ç‰ˆæœ¬ç±»å‹ä»¥åŠå˜æ›´æ—¥å¿—ä¿¡æ¯ï¼Œæœ€åç”Ÿæˆå˜æ›´é›†æ–‡ä»¶ã€‚

é€‰é¡¹å‚æ•°ï¼š
* `--empty`
  åˆ›å»ºç©ºçš„å˜æ›´é›†æ–‡ä»¶ã€‚é€šå¸¸åªæœ‰åœ¨æ‚¨æœ‰é˜»æ­¢åˆå¹¶çš„ CI æ—¶æ‰éœ€è¦ã€‚
* `--open`
  åˆ›å»ºå˜æ›´é›†æ–‡ä»¶ï¼Œå¹¶ç”¨å¤–éƒ¨ç¼–è¾‘å™¨æ‰“å¼€ã€‚

### version

æ¶ˆè€—å˜æ›´é›†æ–‡ä»¶è¿›è¡Œç‰ˆæœ¬æå‡ã€‚
æ­¤å‘½ä»¤ä¼šä¿®æ”¹åŒ… `package.json` çš„ `version` å­—æ®µï¼ŒåŒæ—¶åœ¨åŒ…æ ¹ç›®å½•ä¸‹åˆ›å»º `CHANGELOG.md` æ–‡ä»¶ä»¥è®°å½•æ—¥å¿—ä¿¡æ¯ã€‚

é€‰é¡¹å‚æ•°ï¼š
* `--snapshot`
  ä½¿ç”¨å¿«ç…§å‘å¸ƒã€‚

>[!tip]
>æˆ‘ä»¬å»ºè®®åœ¨è¿è¡Œ publish ä¹‹å‰ï¼Œç¡®ä¿ä»è¿™ä¸ªå‘½ä»¤ç”Ÿæˆçš„æ›´æ”¹è¢«åˆå¹¶å›ä¸»åˆ†æ”¯ã€‚

### publish

åˆ›å»ºgitæ ‡ç­¾å¹¶å‘å¸ƒåŒ…ã€‚å…¶åº•å±‚æ˜¯å¯¹åŒ…ç®¡ç†å™¨ `publish` å‘½ä»¤çš„å°è£…ã€‚
æ­¤å‘½ä»¤ä¼šæ£€æŸ¥æœ¬åœ°åŒ…çš„ç‰ˆæœ¬ä¸ Registry ä¸Šçš„ç‰ˆæœ¬ï¼Œå¦‚æœæœªå‘å¸ƒï¼Œä¾¿ä¼šæ‰§è¡Œå‘å¸ƒåŠ¨ä½œã€‚

>[!warning]
>ç”±äºæ­¤å‘½ä»¤å‡å®šæœ€åä¸€æ¬¡æäº¤ä¸ºå‘å¸ƒæäº¤ï¼Œæ‰€ä»¥åœ¨è°ƒç”¨ version å’Œ publish ä¹‹é—´ä¸åº”æœ‰ä»»ä½•å…¶ä»–æäº¤å˜æ›´çš„æ“ä½œã€‚è¿™ä¸¤ä¸ªå‘½ä»¤åˆ†å¼€æ‰§è¡Œæ˜¯ä¸ºäº†è®©ä½ èƒ½æ£€æŸ¥å°†è¦å‘å¸ƒçš„æ›´æ”¹æ˜¯å¦å‡†ç¡®æ— è¯¯ã€‚

é€‰é¡¹å‚æ•°ï¼š
- `--otp={passowrd}`
  å¦‚æœåŒ…ç®¡ç†å™¨çš„ç”¨æˆ·å¼€å¯äº†åŒå› ç´ è®¤è¯ï¼Œåˆ™éœ€è¦è¯¥é€‰é¡¹æŒ‡å®šä¸€æ¬¡æ€§å¯†ç ã€‚
- `--tag {TAGNAME}`
  å¯ç”¨äºè¦†ç›–é»˜è®¤çš„ `latest` æ ‡ç­¾ï¼Œå°†ç‰ˆæœ¬å‘å¸ƒåˆ°è‡ªå®šä¹‰åˆ†å‘æ ‡ç­¾ã€‚

Git æ ‡ç­¾ï¼š
å¦‚æœ `config.json` ä¸­çš„ `commit:false` åˆ™ `publish` å‘½ä»¤åˆ›å»ºçš„ git æ ‡ç­¾ä¾¿ä¸ä¼šè‡ªåŠ¨æäº¤åˆ°è¿œç¨‹ä»“åº“ï¼Œå› æ­¤éœ€è¦æ‰‹åŠ¨æ¨é€ï¼š
```shell
git push --follow-tags
```

### status

è¿”å› Changesets å½“å‰çš„çŠ¶æ€ä¿¡æ¯ã€‚

æ²¡æœ‰å˜æ›´æ—¶ï¼š
```shell
âœ  changesets-test git:(master) npm run changeset status
ğŸ¦‹  info NO packages to be bumped at patch
ğŸ¦‹  ---
ğŸ¦‹  info NO packages to be bumped at minor
ğŸ¦‹  ---
ğŸ¦‹  info NO packages to be bumped at major
```

å¯¹ `core` è¿›è¡Œæ¬¡ç‰ˆæœ¬å˜æ›´ï¼Œ`pkg` è¿›è¡Œä¿®è¡¥åï¼š
```shell
âœ  changesets-test git:(master) âœ— npm run changeset status
ğŸ¦‹  info Packages to be bumped at patch:
ğŸ¦‹  info 
ğŸ¦‹  - pkg
ğŸ¦‹  ---
ğŸ¦‹  info Packages to be bumped at minor:
ğŸ¦‹  info 
ğŸ¦‹  - core
ğŸ¦‹  ---
ğŸ¦‹  info NO packages to be bumped at major
```

é€‰é¡¹å‚æ•°ï¼š
- `--verbose`
  è¿”å›â€œå˜æ›´é›†â€æ–‡ä»¶çš„é“¾æ¥ä¸é¢„æœŸè¦æå‡çš„æ–°ç‰ˆæœ¬ã€‚
- `--output={"FILE_NAME"}`
  å°†çŠ¶æ€ä¿¡æ¯ä»¥ JSON æ ¼å¼è¾“å‡ºåˆ°æŒ‡å®šçš„æ–‡ä»¶ä¸­ï¼Œä»¥ä¾›å…¶å®ƒå·¥å…·ä½¿ç”¨ã€‚
- `--since`
  ä»…æ˜¾ç¤ºè‡ªç‰¹å®šåˆ†æ”¯æˆ– git æ ‡ç­¾ä»¥åŠ Commit å·(å¦‚Â `main`Â æˆ–æœ€æ–°ç‰ˆæœ¬çš„ git å“ˆå¸Œå€¼)ä¹‹åçš„ changesets ä¿¡æ¯ã€‚ï¼ˆè¿™å¯ä»¥å¸®åŠ©æˆ‘ä»¬æ£€æŸ¥æ˜¯å¦éœ€è¦â€œå˜æ›´é›†â€æ–‡ä»¶ï¼Œä½†æ˜¯æ›´æ¨èä½¿ç”¨ `changeset bot` æ¥æ£€æŸ¥ã€‚ï¼‰


### pre

è¿›å…¥/é€€å‡ºâ€œé¢„å‘å¸ƒæ¨¡å¼â€ã€‚
æ­¤å‘½ä»¤å¿…é¡»æŒ‡å®šé¢„å‘å¸ƒçš„æ ‡ç­¾ã€‚
æ­¤å‘½ä»¤ä¼šåœ¨ `.chagneset` ç›®å½•ä¸‹åˆ›å»º `pre.json` æ–‡ä»¶ã€‚

### tag

ä½¿ç”¨åŒ…çš„ç‰ˆæœ¬æ¥åˆ›å»ºgitæ ‡ç­¾ã€‚
è¯¥å‘½ä»¤çš„è¡Œä¸ºä¸ `changeset publish` åˆ›å»ºgitæ ‡ç­¾ç›¸åŒã€‚ä¸»è¦ç”¨äºè‡ªå®šä¹‰å‘åŒ…çš„åœºæ™¯ï¼Œæ¯”å¦‚ç”¨ `npm run publish -ws` æ›¿ä»£ `changeset publish`ï¼Œæ­¤æ—¶ `changeset add` å¯ä»¥å¾ˆæ–¹ä¾¿çš„ä¸ºæ‰€æœ‰åŒ…åˆ›å»º git æ ‡ç­¾ã€‚ 

é€šå¸¸æ˜¯åœ¨ `changeset tag` ä¹‹å‰è¿è¡Œ `chagneset version` å‘½ä»¤ï¼Œä»¥ä¾¿åœ¨åˆ›å»º git æ ‡ç­¾ä¹‹å‰æ›´æ–°Â `package.json`Â ç‰ˆæœ¬ã€‚

æœ€åè®°å¾—æ‰‹åŠ¨æ¨é€ä¸‹ï¼š
```shell
git push --follow-tags
```

>[!tip]
>åœ¨ Monorepo ä¸­ä¼šç”¨åŒ…åä½œä¸º tag çš„å‰ç¼€ â€”â€” `core@5.0.0`
>åœ¨ Single Package Repo ä¸­ä¼šä½¿ç”¨ `v` ä½œä¸º tag å‰ç¼€ â€”â€” `v1.0.0`

## ä¿®æ”¹æ—¥å¿—æ ¼å¼

Changesets é»˜è®¤ä½¿ç”¨å†…ç½®çš„ `@changesets/changelog-git` åŒ…ç”Ÿæˆé»˜è®¤çš„æ—¥å¿—ä¿¡æ¯ã€‚è‹¥è¦è‡ªå®šä¹‰æ—¥å¿—ç”Ÿæˆæ ¼å¼å¹¶æ·»åŠ é¢å¤–ä¿¡æ¯ï¼Œå¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶çš„ `chagnelog` å­—æ®µæ¥è‡ªå®šä¹‰æ—¥å¿—ç”Ÿæˆæ–¹æ³•ã€‚

é€šè¿‡æŸ¥çœ‹ `@changesets/changelog-git` æºç å¯çŸ¥å®ƒä¸»è¦å®ç°äº†ä»¥ä¸‹ä¸¤ä¸ªæ–¹æ³•ï¼š
- `getReleaseLine`ï¼šè·å–å½“å‰çš„ç‰ˆæœ¬å‘å¸ƒçº¿ã€‚
- `getDependencyReleaseLine`ï¼šè·å–ä¾èµ–çš„ç‰ˆæœ¬å‘å¸ƒçº¿ã€‚

> ä»ä¸Šä¸€æ¬¡ `chagneset publish` ååˆ°æœ€è¿‘ä¸€æ¬¡å°†è¦å‘å¸ƒçš„æ‰€æœ‰å˜æ›´å°±æ˜¯ä¸€æ¡ç‰ˆæœ¬å‘å¸ƒçº¿ï¼ˆRelease Lineï¼‰ã€‚

ä¸‹é¢æ˜¯æ–¹æ³•çš„æ‰§è¡Œæ—¶æœºï¼š
* `getReleaseLine` æ–¹æ³•ä¼šåœ¨æ¶ˆè€—å˜æ›´é›†æ–‡ä»¶æ—¶ä¸ºæ¯ä¸ªå—å½±å“çš„åŒ…è°ƒç”¨ä¸€æ¬¡ï¼Œå¦‚æœä¸€ä¸ª changeset å‰è¨€æ•°æ®åˆ—å‡ºäº†å¤šä¸ªå—å½±å“çš„åŒ…ï¼Œè¿™ä¼šä¸ºæ¯ä¸ªåŒ…éƒ½è°ƒç”¨ä¸€æ¬¡è¯¥æ–¹æ³•ï¼Œä»¥ç”Ÿæˆæ—¥å¿—ä¿¡æ¯ã€‚
* `getDependencyReleaseLine` è¯¥æ–¹æ³•ä¼šåœ¨â€œåŒ…â€çš„ä¾èµ–åŒ…å‘ç”Ÿå˜æ›´æ—¶è°ƒç”¨ï¼Œç”¨äºç”Ÿæˆä¾èµ–è€…åŒ…çš„æ—¥å¿—ä¿¡æ¯ã€‚å› ä¸ºå¯èƒ½ä¼šæœ‰å¤šä¸ªä¾èµ–ï¼Œæ‰€ä»¥è¿™é‡Œæ¥æ”¶çš„å‚æ•°æ˜¯ä¸€ä¸ªæ•°ç»„ã€‚

ä¸‹é¢æ˜¯æ–¹æ³•å‚æ•°è¯´æ˜ï¼š
- `getReleaseLine(changeset, type, options)`
 ```typescript
type VersionType = 'patch' | 'minor' | 'major';
type Changeset = {
	summary:string; //å½“å‰ changeset æ–‡ä»¶çš„æ‘˜è¦ï¼Œå¦‚æœæœ‰è¡Œï¼Œåˆ™ç”¨\nè¡¨ç¤ºæ¢è¡Œã€‚
	id:string // changeset æ–‡ä»¶çš„åç§°ã€‚
	// è¿”å›æœ€è¿‘ä¸€æ¬¡åŒ…å«å˜æ›´é›†åˆæ–‡ä»¶çš„ commit å·ã€‚ å¦‚æœå¼€å¯äº†è‡ªåŠ¨ git æ·»åŠ ä¸æäº¤ã€‚
	commit:string 
	// ä¸€ä¸ªæ•°ç»„ï¼Œå¦‚æœä¸€ä¸ª changeset æ–‡ä»¶ä¸­æœ‰å¤šä¸ªåŒ…ã€‚
	release:{name:string, type:VersionType}[] 
}

type Type = VersionType; //è¦æå‡çš„ç‰ˆæœ¬ç±»å‹ã€‚
```

- `getDependencyReleaseLine(changesets, dependenciesUpdated, options)`
```ts
type Changesets = Changeset[];
type dependenciesUpdated = {
	name:string //ä¾èµ–åŒ…çš„åŒ…å
	type:VersionType //ç‰ˆæœ¬æå‡ç±»å‹ã€‚
	oldVersion:string // æ—§ç‰ˆæœ¬
	newVersion:string // æå‡çš„æ–°ç‰ˆæœ¬ã€‚
	changesets:string[] //å˜æ›´é›†æ–‡ä»¶åæ•°ç»„
	packageJson:Record<string,string> //ä¾èµ–åŒ…çš„ package.json æ–‡ä»¶å†…å®¹
	dir:string //ä¾èµ–åŒ…çš„ä½ç½®ã€‚
 }
```

ç¬¬ä¸‰ä¸ªå‚æ•° `options`ï¼Œå¯ä»¥é…ç½®è‡ªå®šä¹‰æ¨¡å—æ—¶ä¸€åŒä¼ å…¥ï¼š
```json
{
	"changelog":["./changelog.js", {"repo": "xxx"}]
}
```
å…·ä½“å®ç°å¯ä»¥å‚è€ƒ `@changesets/changelog-github` åŒ…ã€‚

ä¸‹é¢æ˜¯è‡ªå®šä¹‰æ¨¡å—çš„å…·ä½“å®ç°ï¼š
```ts
import { NewChangesetWithCommit, VersionType, ChangelogFunctions, ModCompWithPackage } from '@changesets/types';

function getCommit(commit?: string) {
  if (!commit) {
    return '';
  }
  return `[${commit}](https://git.gametaptap.com/web-frontend/web-internal/tds-iem-mono/commits/${commit})`;
}

const getReleaseLine = async (changeset: NewChangesetWithCommit, _type: VersionType) => {
  const [firstLine, ...futureLines] = changeset.summary.split('\n').map((l) => l.trimRight());

  let returnVal = `
#### ${firstLine}(${getCommit(changeset.commit)})`;

  if (futureLines.length > 0) {
    returnVal += `\n${futureLines.map((l) => `${l}`).join('\n')}`;
  }

  return returnVal;
};

const getDependencyReleaseLine = async (
  changesets: NewChangesetWithCommit[],
  dependenciesUpdated: ModCompWithPackage[],
) => {
  if (dependenciesUpdated.length === 0) return '';

  const changesetLinks =
    'å¦‚ä¸‹ commit(' + changesets.map((changeset) => ` ${getCommit(changeset.commit)} `).join(',') + ') æ›´æ–°äº†ä¾èµ–ï¼š';

  const updatedDepenenciesList = dependenciesUpdated.map(
    (dependency) => `  - ${dependency.name}@${dependency.newVersion}`,
  );

  return ['\n#### ä¾èµ–å˜æ›´',changesetLinks, ...updatedDepenenciesList].join('\n');
};

const defaultChangelogFunctions: ChangelogFunctions = {
  getReleaseLine,
  getDependencyReleaseLine,
};

export default defaultChangelogFunctions;

```

>[!warning]
>åœ¨æ‰§è¡Œ `changeset version` æ—¶ï¼Œå¦‚æœè¦æ¶ˆè€—çš„å˜æ›´é›†æ–‡ä»¶æ²¡æœ‰æäº¤åˆ° git ä¸­ï¼Œé‚£ä¹ˆ `getReleaseLine` ä¸ `getDependencyReleaseLine` ä¸¤ä¸ªæ–¹æ³•çš„ `changeset` å‚æ•°çš„ `commit` å±æ€§å€¼å¯èƒ½ä¸º `undefined`ã€‚

## è‡ªåŠ¨åŒ–æµç¨‹



## å¸¸è§é—®é¢˜

### ä»€ä¹ˆæ—¶å€™éœ€è¦æ·»åŠ å¤šä¸ªå˜æ›´é›†æ–‡ä»¶ï¼Ÿ

- æ‚¨æƒ³è¦å‘å¸ƒå…·æœ‰ä¸åŒæ›´æ–°æ—¥å¿—æ¡ç›®çš„å¤šä¸ªè½¯ä»¶åŒ… â€”â€” æ›´æ–°äº†å¤šä¸ªåŒ…ã€‚
- æ‚¨å¯¹åŒ…è¿›è¡Œäº†å¤šé¡¹æ›´æ”¹ï¼Œæ¯é¡¹æ›´æ”¹å‡åº”å•ç‹¬è°ƒç”¨ â€”â€” åšäº†å¤šæ¬¡ä¸åŒçš„æ›´æ”¹ã€‚

### å¦‚ä½•ç¼–å†™å˜æ›´é›†æ–‡ä»¶ï¼Ÿ

1. WHAT the change is  ï¼ˆå˜æ›´çš„å†…å®¹æ˜¯ä»€ä¹ˆï¼Ÿï¼‰
2. WHY the change was made  ï¼ˆå˜æ›´çš„åŸå› ï¼‰
3. HOW a consumer should update their code ï¼ˆæ¶ˆè´¹è€…å¦‚ä½•æ›´æ–°ä»–ä»¬çš„ä»£ç ï¼‰

---
## å‚è€ƒ

- [Changesets: æµè¡Œçš„ monorepo åœºæ™¯å‘åŒ…å·¥å…·](https://zhuanlan.zhihu.com/p/427588430)
- [Changesets å®˜æ–¹ä¸­æ–‡æ–‡æ¡£](https://changesets-docs.vercel.app/zh-CN)